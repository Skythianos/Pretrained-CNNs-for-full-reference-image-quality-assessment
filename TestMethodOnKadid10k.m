function [Results] = TestMethodOnKadid10k(netName, pathToImages, dmos, dist_img, ref_img, FR_Metrics, method)

if strcmp(netName,'AlexNet')
    net = alexnet;
    Layers = {'conv1','conv2','conv3','conv4','conv5'};
elseif strcmp(netName,'VGG16')
    net = vgg16;
    Layers = {'conv1_1','conv1_2','conv2_1','conv2_2','conv3_1','conv3_2','conv3_3','conv4_1','conv4_2','conv4_3',...
        'conv5_1','conv5_2','conv5_3'};
elseif strcmp(netName,'VGG19')
    net = vgg19;
    Layers = {'conv1_1','conv1_2','conv2_1','conv2_2','conv3_1','conv3_2','conv3_3','conv3_4','conv4_1','conv4_2','conv4_3',...
        'conv4_4','conv5_1','conv5_2','conv5_3','conv5_4'};
elseif strcmp(netName,'ResNet18')    
    net = resnet18;
    Layers = {'conv1','res2a_branch2a','res2a_branch2b','res2b_branch2a','res2b_branch2b','res3a_branch2a','res3a_branch2b',...
        'res3a_branch1','res3b_branch2a','res3b_branch2b','res4a_branch2a','res4a_branch2b','res4a_branch1','res4b_branch2a',...
        'res4b_branch2b','res5a_branch2a','res5a_branch2b','res5a_branch1','res5b_branch2a','res5b_branch2b'};       
elseif strcmp(netName,'ResNet101')
    net = resnet101;
    Layers = {...
        'conv1', 'res2a_branch2a', 'res2a_branch2b', 'res2a_branch2c', 'res2a_branch1', 'res2b_branch2a',...
        'res2b_branch2b', 'res2b_branch2c', 'res2c_branch2a', 'res2c_branch2b', 'res2c_branch2c',...
        'res3a_branch2a', 'res3a_branch2b', 'res3a_branch2c', 'res3a_branch1', 'res3b1_branch2a',...
        'res3b1_branch2b', 'res3b1_branch2c', 'res3b2_branch2a', 'res3b2_branch2b', 'res3b2_branch2c',...
        'res3b3_branch2a', 'res3b3_branch2b', 'res3b3_branch2c', 'res4a_branch2a', 'res4a_branch2b',...
        'res4a_branch2c', 'res4a_branch1', 'res4b1_branch2a', 'res4b1_branch2b', 'res4b1_branch2c',...
        'res4b2_branch2a', 'res4b2_branch2b', 'res4b2_branch2c', 'res4b3_branch2a', 'res4b3_branch2b',...
        'res4b3_branch2c', 'res4b4_branch2a', 'res4b4_branch2b', 'res4b4_branch2c', 'res4b5_branch2a',...
        'res4b5_branch2b', 'res4b5_branch2c', 'res4b6_branch2a', 'res4b6_branch2b', 'res4b6_branch2c',...
        'res4b7_branch2a', 'res4b7_branch2b', 'res4b7_branch2c', 'res4b8_branch2a', 'res4b8_branch2b',...
        'res4b8_branch2c', 'res4b9_branch2a', 'res4b9_branch2b', 'res4b9_branch2c', 'res4b10_branch2a',...
        'res4b10_branch2b', 'res4b10_branch2c', 'res4b11_branch2a', 'res4b11_branch2b', 'res4b11_branch2c',...
        'res4b12_branch2a', 'res4b12_branch2b', 'res4b12_branch2c', 'res4b13_branch2a', 'res4b13_branch2b',...
        'res4b13_branch2c', 'res4b14_branch2a', 'res4b14_branch2b', 'res4b14_branch2c', 'res4b15_branch2a',...
        'res4b15_branch2b', 'res4b15_branch2c', 'res4b16_branch2a', 'res4b16_branch2b', 'res4b16_branch2c',...
        'res4b17_branch2a', 'res4b17_branch2b', 'res4b17_branch2c', 'res4b18_branch2a', 'res4b18_branch2b',...
        'res4b18_branch2c', 'res4b19_branch2a', 'res4b19_branch2b', 'res4b19_branch2c', 'res4b20_branch2a',...
        'res4b20_branch2b', 'res4b20_branch2c', 'res4b21_branch2a', 'res4b21_branch2b', 'res4b21_branch2c',...
        'res4b22_branch2a', 'res4b22_branch2b', 'res4b22_branch2c', 'res5a_branch2a', 'res5a_branch2b',...
        'res5a_branch2c', 'res5a_branch1', 'res5b_branch2a', 'res5b_branch2b', 'res5b_branch2c', 'res5c_branch2a',...
        'res5c_branch2b', 'res5c_branch2c'};
elseif strcmp(netName,'InceptionV3')
    net = inceptionv3;
    Layers = {...
        'conv2d_1', 'conv2d_2', 'conv2d_3', 'conv2d_4', 'conv2d_5', 'conv2d_9', 'conv2d_7',...
        'conv2d_10', 'conv2d_6', 'conv2d_8', 'conv2d_11', 'conv2d_12', 'conv2d_16', 'conv2d_14',...
        'conv2d_17', 'conv2d_13', 'conv2d_15', 'conv2d_18', 'conv2d_19', 'conv2d_23', 'conv2d_21',...
        'conv2d_24', 'conv2d_20', 'conv2d_22', 'conv2d_25', 'conv2d_26', 'conv2d_28', 'conv2d_29',...
        'conv2d_27', 'conv2d_30', 'conv2d_35', 'conv2d_36', 'conv2d_32', 'conv2d_37', 'conv2d_33',...
        'conv2d_38', 'conv2d_31', 'conv2d_34', 'conv2d_39', 'conv2d_40', 'conv2d_45', 'conv2d_46',...
        'conv2d_42', 'conv2d_47', 'conv2d_43', 'conv2d_48', 'conv2d_41', 'conv2d_44', 'conv2d_49',...
        'conv2d_50', 'conv2d_55', 'conv2d_56', 'conv2d_52', 'conv2d_57', 'conv2d_53', 'conv2d_58',...
        'conv2d_51', 'conv2d_54', 'conv2d_59', 'conv2d_60', 'conv2d_65', 'conv2d_66', 'conv2d_62',...
        'conv2d_67', 'conv2d_63', 'conv2d_68', 'conv2d_61', 'conv2d_64', 'conv2d_69', 'conv2d_70',...
        'conv2d_73', 'conv2d_74', 'conv2d_71', 'conv2d_75', 'conv2d_72', 'conv2d_76', 'conv2d_81',...
        'conv2d_78', 'conv2d_82', 'conv2d_79', 'conv2d_80', 'conv2d_83', 'conv2d_84', 'conv2d_77',...
        'conv2d_85', 'conv2d_90', 'conv2d_87', 'conv2d_91', 'conv2d_88', 'conv2d_89', 'conv2d_92',...
        'conv2d_93', 'conv2d_86', 'conv2d_94'};
else
    error('Unknown CNN'); 
end

numberOfImages = size(dmos,1);
predictedQuality = zeros(numberOfImages,1);

parfor i=1:numberOfImages
    
    if mod(i,100)==0
        disp(i);
    end
    
    refImageName = strcat(pathToImages, filesep, ref_img{i});
    distImageName= strcat(pathToImages, filesep, dist_img{i});
    
    refImage = imread(char(refImageName));
    distImage= imread(char(distImageName));
    
    predictedQuality(i)=GetScore(refImage,distImage,net,Layers,FR_Metrics,method);
end

Results.PLCC = corr(predictedQuality, dmos);
Results.SROCC= corr(predictedQuality, dmos, 'Type', 'Spearman');
Results.KROCC= corr(predictedQuality, dmos, 'Type', 'Kendall');

end
